@using BookShop.BLL.ConfigurationModel.PromotionTypeModel;
@model BookShop.BLL.ConfigurationModel.PromotionModel.UpdatePromotionModel

@{
	ViewData["Title"] = "Sửa khuyến mãi";
	Layout = "~/Areas/Admin/Views/Shared/_adminLayout.cshtml";
}

<div class="row">
	<div class="col-md-6">
		<form asp-action="Edit" class="mt-3" style="max-width: 1000px">
			<input asp-for="Id" hidden />
			<div class="form-group">
				<label class="form-label">Loại khuyến mãi</label>
				<select asp-for="Id_Type" id="promotionType" required onchange="typeCheck(this)">
					<option value="@Model.Id_Type" selected>@Model.NameType</option>
				</select>
			</div>
			<div class="form-group" id="promotionCode">
				<label class="form-label">Mã khuyến mãi (nếu bỏ trống mã sẽ được gen tự động)</label>
				<input asp-for="Code" id="inputCode" class="form-control" />
			</div>
			<div class="form-group">
				<label class="form-label">Tên mã khuyến mãi</label>
				<input asp-for="Name" class="form-control" required />
			</div>
			<div class="form-group" id="promotionCondition">
				<label class="form-label">Điều kiện giảm (Giá trị đơn hàng tối thiểu để có thể áp dụng mã)</label>
				<input type="number" asp-for="Condition" id="inputCondition" class="form-control" />
			</div>
			<div class="form-group" id="promorionConversionPoint">
				<label class="form-label">Số điểm đổi</label>
				<input type="number" asp-for="ConversionPoint" id="inputConversionPoint" class="form-control" />
			</div>
			<div class="form-group" id="promotionStorageTerm">
				<label class="form-label">Thời gian lưu trữ (ngày)</label>
				<input type="number" asp-for="StorageTerm" id="inputStorageTerm" class="form-control" />
			</div>
			<div>
				<br /> &ensp;
				<input type="radio" id="percent" name="typeReduct" value="1" onchange="handleRadioChange(this.value)" /><span> Giảm theo phần trăm</span> &ensp;
				<input type="radio" id="amount" name="typeReduct" value="0" onchange="handleRadioChange(this.value)" /><span> Giảm theo số tiền cố định</span>
			</div>
			<div class="form-group" id="amountReduct">
				<label class="form-label">Số tiền giảm (đ)</label>
				<input type="number" asp-for="AmountReduct" id="inputAmount" class="form-control" />
			</div>
			<div class="form-group" id="percentReduct">
				<label class="form-label">Số phần trăm giảm (%)</label>
				<input type="number" asp-for="PercentReduct" id="inputPercent" class="form-control" />

				<label class="form-label">Số tiền giảm tối đa (đ)</label>
				<input type="number" asp-for="ReductMax" id="inputMax" class="form-control" />
			</div>
			<div class="form-group">
				<label class="form-label">Số lượng phát hành</label>
				<input type="number" asp-for="Quantity" class="form-control" required />
			</div>
			<div class="form-group">
				<label class="form-label">Ngày bắt đầu</label>
				<input asp-for="StartDate" class="form-control" required />
			</div>
			<div class="form-group">
				<label class="form-label">Ngày kết thúc</label>
				<input asp-for="EndDate" class="form-control" required />
			</div>
			<div class="form-group">
				<label class="form-label">Mô tả</label>
				<textarea asp-for="Description" class="form-control" row="3"></textarea>
			</div>
			<div class="form-group">
				<label class="form-label">Trạng thái</label>
				<select asp-for="Status" class="form-control">
					<option value="1">Áp dụng</option>
					<option value="0">Không áp dụng</option>
				</select>
			</div>
			<div class="form-group">
				<input type="submit" value="Save" class="btn btn-primary m-3" />
			</div>
		</form>
	</div>
</div>

<div>
	<a asp-action="Index">Back to List</a>
</div>

<script type="text/javascript">
	function typeCheck() {
		var select = document.getElementById('promotionType');
		var selectText = select.options[select.selectedIndex].text;
		const code = $("#promotionCode");
		const condition = $("#promotionCondition");
		const storageTerm = $("#promotionStorageTerm");
		const conversionPoint = $("#promorionConversionPoint");
		const inputCode = $("#inputCode");
		const inputCondition = $("#inputCondition");
		const inputConversionPoint = $("#inputConversionPoint");
		const inputStorageTerm = $("#inputStorageTerm");

		inputCode.val('');
		inputCondition.val('');
		inputCondition.prop("required", false);
		inputStorageTerm.val('');
		inputStorageTerm.prop("required", false);
		inputConversionPoint.val('');
		inputConversionPoint.prop("required", false);

		if (selectText === "Phiếu khuyến mãi áp dụng tự động") {
			code.prop("hidden", true);
			condition.prop("hidden", false);
			inputCondition.val(@Model.Condition);
			storageTerm.prop("hidden", true);
			conversionPoint.prop("hidden", true);
			inputCondition.prop("required", true);
		} else if (selectText === "Phiếu khuyến mãi điểm đổi") {
			code.prop("hidden", true);
			condition.prop("hidden", false);
			inputCondition.val(@Model.Condition);
			storageTerm.prop("hidden", false);
			inputStorageTerm.val(@Model.StorageTerm);
			conversionPoint.prop("hidden", false);
			inputConversionPoint.val(@Model.ConversionPoint);
			inputCondition.prop("required", true);
			inputStorageTerm.prop("required", true);
			inputConversionPoint.prop("required", true);
		} else if (selectText === "Phiếu khuyến mãi phát hành mã") {
			code.prop("hidden", false);
			condition.prop("hidden", false);
			inputCondition.val(@Model.Condition);
			storageTerm.prop("hidden", false);
			inputStorageTerm.val(@Model.StorageTerm);
			conversionPoint.prop("hidden", true);
			inputCondition.prop("required", true);
			inputStorageTerm.prop("required", true);
		} else if (selectText === "Phiếu giảm giá sản phẩm") {
			code.prop("hidden", true);
			condition.prop("hidden", true);
			storageTerm.prop("hidden", true);
			conversionPoint.prop("hidden", true);
		} else console.log("Not found")
	}

	// Hàm xử lý khi input radio thay đổi
	function handleRadioChange(value) {
		const amount = $("#amountReduct");
		const percent = $("#percentReduct");
		const inputAmount = $("#inputAmount");
		const inputPercent = $("#inputPercent");
		const inputMax = $("#inputMax");

		inputAmount.prop("required", false);
		inputPercent.prop("required", false);
		inputMax.prop("required", false);
		// const selectedValue = event.target.value;
		if (value == 1) {
			amount.prop("hidden", true);
			percent.prop("hidden", false);
			inputPercent.prop("required", true);
			inputMax.prop("required", true);
			inputPercent.val(@Model.PercentReduct);
			inputAmount.val('');
			inputMax.val(@Model.ReductMax);
		} else if (value == 0) {
			amount.prop("hidden", false);
			percent.prop("hidden", true);
			inputAmount.prop("required", true);
			inputPercent.val('');
			inputMax.val('');
			inputAmount.val(@Model.AmountReduct);
		}
	};

	$(document).ready(function () {
		typeCheck();
		if (parseInt(@Model.AmountReduct) !== 0) {
			$("#amount").prop("checked", true);
			handleRadioChange(0);
		} else if (parseInt(@Model.PercentReduct) !== 0) {
			$("#percent").prop("checked", true);
			handleRadioChange(1);
		}
	})
</script>
