@model BookShop.BLL.ConfigurationModel.PromotionModel.PromotionViewModel

@{
	ViewData["Title"] = "Edit";
	Layout = "~/Areas/Admin/Views/Shared/_adminLayout.cshtml";
}


<hr />
<div class="row">
	<div class="col-md-4">
		<form asp-action="Edit">
			<div asp-validation-summary="ModelOnly" class="text-danger"></div>
			<div class="form-group">
				<label asp-for="Name" class="control-label">Tên khuyến mãi</label>
				<input asp-for="Name" class="form-control" />
				<span asp-validation-for="Name" class="text-danger"></span>
			</div>

			<div class="form-group">
				<div class="radio-group">
					<label asp-for="ReduceByAmount" class="control-label radio-label">
						Giảm theo tiền:
						<input asp-for="ReduceByAmount" id="ReduceByAmount" type="radio" name="reductionType" value="amount" class="reduction-radio" />
					</label>
					<div id="amountFields" class="reduction-fields hidden">
						<label asp-for="AmountReduct" class="control-label">Số tiền giảm:</label>
						<input asp-for="AmountReduct" id="AmountReduct" class="form-control" />
						<span asp-validation-for="AmountReduct" class="text-danger"></span>
					</div>
				</div>
				<div class="radio-group">
					<label asp-for="ReduceByPercentage" class="control-label radio-label">
						Giảm theo phần trăm:
						<input asp-for="ReduceByPercentage" id="ReduceByPercentage" type="radio" name="reductionType" value="percentage" class="reduction-radio" />
					</label>
					<div id="percentageFields" class="reduction-fields hidden">
						<label asp-for="PercentReduct" class="control-label">Phần trăm giảm:</label>
						<input asp-for="PercentReduct" id="PercentReduct" class="form-control" />
						<span asp-validation-for="PercentReduct" class="text-danger"></span>

						<label asp-for="ReductMax" class="control-label">Giảm tối đa:</label>
						<input asp-for="ReductMax" id="ReductMax" class="form-control" />
						<span asp-validation-for="ReductMax" class="text-danger"></span>
					</div>
				</div>
			</div>

			<div class="form-group">
				<label for="Id_Type">Loại khuyến mãi: </label>
				<select class="form-control" asp-for="Id_Type" asp-items="@ViewBag.PromotionTypeId" id="Id_Type" name="Id_Type" required>
					<option value="" disabled selected>Chọn loại khuyến mãi</option>
				</select>
			</div>
			@* theo loai khuyem mai *@
			<div id="condition" class="form-group" style="display:block;">
				<label asp-for="Condition" class="control-label">Số tiền tối thiểu: </label>
				<input asp-for="Condition" type="text" class="form-control" id="Condition" name="Condition" />
				<span asp-validation-for="Condition" class="text-danger"></span>
			</div>
			<div cid="storageTerm" class="form-group" style="display:block;">
				<label asp-for="StorageTerm" class="control-label">Thời hạn lưu trữ: </label>
				<input asp-for="StorageTerm" type="text" class="form-control" id="StorageTerm" name="StorageTerm" />
				<span asp-validation-for="StorageTerm" class="text-danger"></span>
			</div>
			<div id="quantityLimit" class="form-group" style="display:block;">
				<label asp-for="Quantity" class="control-label">Số lượng: </label>
				<input asp-for="Quantity" type="text" class="form-control" id="Quantity" name="Quantity" />
				<span asp-validation-for="Quantity" class="text-danger"></span>
			</div>
			<div id="conversionPoint" class="form-group" style="display:block;">
				<label asp-for="ConversionPoint">Điểm quy đổi:</label>
				<input asp-for="ConversionPoint" type="text" class="form-control" id="ConversionPoint" name="ConversionPoint" />
				<span asp-validation-for="ConversionPoint" class="text-danger"></span>
			</div>
			@* chung *@
			<div class="form-group">
				<label asp-for="StartDate" class="control-label">Ngày bắt đầu: </label>
				<input asp-for="StartDate" class="form-control" />
				<span asp-validation-for="StartDate" class="text-danger"></span>
			</div>
			<div class="form-group">
				<label asp-for="EndDate" class="control-label">Ngày kết thúc: </label>
				<input asp-for="EndDate" class="form-control" />
				<span asp-validation-for="EndDate" class="text-danger"></span>
			</div>
			<div class="form-group">
				<label asp-for="Description" class="control-label">Mô tả: </label>
				<input asp-for="Description" class="form-control" />
				<span asp-validation-for="Description" class="text-danger"></span>
			</div>
			<div class="form-group">
				<label>Trạng thái: </label>
				<input type="hidden" asp-for="Status" id="statusHidden" />
				<input type="checkbox" asp-for="StatusCheckbox" id="statusCheckbox" onchange="updateStatus()" />
			</div>
			<div class="form-group">
				<input type="submit" value="Save" class="btn btn-primary" />
				<a asp-action="Index">Back to List</a>
			</div>
		</form>
	</div>
</div>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		// Lấy giá trị của Status từ ô ẩn và kiểm tra nếu là 1 thì chọn checkbox
		var statusValue = document.getElementById("statusHidden").value;
		var statusCheckbox = document.getElementById("statusCheckbox");

		if (statusValue === "1") {
			statusCheckbox.checked = true;
		}
	});

	// Hàm này sẽ được gọi khi trạng thái của checkbox thay đổi
	function updateStatus() {
		var statusCheckbox = document.getElementById("statusCheckbox");
		var statusHidden = document.getElementById("statusHidden");

		// Cập nhật giá trị của ô ẩn (Status) dựa trên trạng thái của checkbox
		statusHidden.value = statusCheckbox.checked ? "1" : "0";
	}
</script>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		// Kiểm tra và cập nhật trạng thái khi trang được tải
		checkReductionFields();

		// Lắng nghe sự kiện khi giá trị của các ô thay đổi
		document.getElementById("AmountReduct").addEventListener("input", checkReductionFields);
		document.getElementById("PercentReduct").addEventListener("input", checkReductionFields);
		document.getElementById("ReductMax").addEventListener("input", checkReductionFields);

		// Lắng nghe sự kiện khi radiobuttons thay đổi
		var reductionRadios = document.querySelectorAll(".reduction-radio");
		reductionRadios.forEach(function (radio) {
			radio.addEventListener("click", checkReductionFields);
		});
	});

	// Hàm kiểm tra và cập nhật trạng thái dựa trên dữ liệu
	function checkReductionFields() {
		var amountReductValue = document.getElementById("AmountReduct").value;
		var percentReductValue = document.getElementById("PercentReduct").value;
		var reductMaxValue = document.getElementById("ReductMax").value;

		// Kiểm tra và cập nhật trạng thái cho ReduceByAmount
		var reduceByAmountRadio = document.getElementById("ReduceByAmount");
		var amountFields = document.getElementById("amountFields");
		reduceByAmountRadio.checked = amountReductValue !== null && amountReductValue !== '';
		amountFields.classList.toggle("hidden", !reduceByAmountRadio.checked);

		// Kiểm tra và cập nhật trạng thái cho ReduceByPercentage
		var reduceByPercentageRadio = document.getElementById("ReduceByPercentage");
		var percentageFields = document.getElementById("percentageFields");
		reduceByPercentageRadio.checked = (percentReductValue !== null && percentReductValue !== '') || (reductMaxValue !== null && reductMaxValue !== '');
		percentageFields.classList.toggle("hidden", !reduceByPercentageRadio.checked);

		// Ẩn các dòng dữ liệu không liên quan
		if (reduceByAmountRadio.checked) {
			percentageFields.classList.add("hidden");
		} else if (reduceByPercentageRadio.checked) {
			amountFields.classList.add("hidden");
		}
	}
</script>
